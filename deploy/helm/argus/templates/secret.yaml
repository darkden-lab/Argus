apiVersion: v1
kind: Secret
metadata:
  name: {{ include "argus.fullname" . }}-secret
  labels:
    {{- include "argus.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.backend.env.databaseURL }}
  databaseURL: {{ .Values.backend.env.databaseURL | b64enc | quote }}
  {{- else if .Values.postgresql.enabled }}
  databaseURL: {{ printf "postgres://%s:%s@%s-postgres:5432/%s?sslmode=disable" .Values.postgresql.env.username .Values.postgresql.env.password (include "argus.fullname" .) .Values.postgresql.env.database | b64enc | quote }}
  {{- else }}
  databaseURL: {{ "" | b64enc | quote }}
  {{- end }}
  {{- if .Values.backend.env.jwtSecret }}
  jwtSecret: {{ .Values.backend.env.jwtSecret | b64enc | quote }}
  {{- else }}
  jwtSecret: {{ "dev-jwt-secret-change-in-production" | b64enc | quote }}
  {{- end }}
  {{- if .Values.backend.env.encryptionKey }}
  encryptionKey: {{ .Values.backend.env.encryptionKey | b64enc | quote }}
  {{- else }}
  encryptionKey: {{ "dev-encryption-key-32chars00000000" | b64enc | quote }}
  {{- end }}
  dbPassword: {{ .Values.postgresql.env.password | b64enc | quote }}
  {{- if .Values.oidc.enabled }}
  oidcClientSecret: {{ .Values.oidc.clientSecret | b64enc | quote }}
  {{- end }}
